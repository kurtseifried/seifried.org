<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=windows-1252">
<TITLE>Kurt Seifried - Security / Security Advisories / KSSA-005 MS-DOS Reserved Device Name Vulnerability In Sophos Anti-Virus</TITLE>
</HEAD>
<BODY LANG="en-US" BGCOLOR="#ffffff" DIR="LTR">
<H1><STRONG>Kurt Seifried Security Advisory 005 (KSSA-005)</STRONG></H1>
<P>Created by Kurt Seifried, <A HREF="/cdn-cgi/l/email-protection#afc4dadddbefdccac6c9ddc6cacb81c0ddc8"><span class="__cf_email__" data-cfemail="d6bda3a4a296a5b3bfb0a4bfb3b2f8b9a4b1">[email&#160;protected]</span><script data-cfhash='f9e31' type="text/javascript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script></A>
</P>
<P><A HREF="http://www.seifried.org/security/advisories/kssa-005.html">http://www.seifried.org/security/advisories/kssa-005.html</A>,
<A HREF="/cdn-cgi/l/email-protection#86edf3f4f2c6f5e3efe0f4efe3e2a8e9f4e1"><span class="__cf_email__" data-cfemail="375c4245437744525e51455e525319584550">[email&#160;protected]</span><script data-cfhash='f9e31' type="text/javascript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script></A></P>
<P>Version 1.0 &ndash; 1/10/2004</P>
<HR>
<P><STRONG>Title: MS-DOS Reserved Device Name Vulnerability In Sophos Anti-Virus</STRONG>
</P>
<P>Multiple antivirus products, such as Sophos Small Business Suite
antivirus fail to properly access and scan files and directories that
use reserved MS-DOS device names. Sophos Small Business Suite
antivirus on access scanner can also fail in some situations,
allowing viruses to replicate.
</P>
<P><B>CVE / CERT / BID / Other identifiers:</B></P>
<P>CVE: CAN-2004-0552</P>
<P><STRONG>Issue date:</STRONG></P>
<P>1/10/2004</P>
<P><STRONG>Who should read this advisory:</STRONG></P>
<P>Anyone using Sophos Small Business Suite antivirus, or other
antivirus products that may be affected. Please note that not all
antivirus products are vulnerable, however extensive testing has not
yet been conducted against all available antivirus products (as there
are several).</P>
<P><STRONG>Author and contact info:</STRONG></P>
<P>This advisory is copyright 2004, Kurt Seifried, <A HREF="/cdn-cgi/l/email-protection#c6adb3b4b286b5a3afa0b4afa3a2e8a9b4a1"><span class="__cf_email__" data-cfemail="a8c3dddadce8dbcdc1cedac1cdcc86c7dacf">[email&#160;protected]</span><script data-cfhash='f9e31' type="text/javascript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script></A>,
<A HREF="http://www.seifried.org/">http://www.seifried.org/</A>
</P>
<P><STRONG>Overview:</STRONG></P>
<P>MS-DOS reserved device names are a hold over from the original
days of Microsoft DOS. The reserved MS-DOS device names represent
devices, such as lpt1 (the first printer port), com1 (the first
serial communication port) and so on. These names are resered for
devices, and normally files and directories cannot be named with
these reserved names. Many products such as backup software and
antivirus software do not deal properly with reserved MS-DOS device
names.
</P>
<P><STRONG>Affected software:</STRONG></P>
<P>Sophos Small Business Suite antivirus is confirmed vulnerable,
other Sophos products are affected as well.
</P>
<P><STRONG>Impact:</STRONG></P>
<P>A virus/trojan/malcode can avoid detection on a system normally
protected by Sophos Small Business Suite antivirus. Sophos will stall
(stops scanning) when it encounters an MS-DOS reserved device name
directory containing an MS-DOS reserved filename. Backdoors and other
spyware can avoid detection by using reserved MS-DOS device names.
Additionally when certain filenames are used, such as &ldquo;lpt1&rdquo;
and &ldquo;prn&rdquo; a virus can be copied without being detected by
the on access scanner (read or write). Virus execution may be able to
bypass real-time detection if it launches from an MS-DOS reserved
device name.
</P>
<P><STRONG><FONT COLOR="#000000">Details:</FONT></STRONG></P>
<P STYLE="margin-bottom: 0in">On Windows 2000 and XP for example if
you execute the command:</P>
<PRE STYLE="margin-left: 0.79in; margin-bottom: 0.2in">C:\&gt; mkdir aux</PRE><P>
You will receive the error message:</P>
<PRE STYLE="margin-left: 0.79in; margin-bottom: 0.2in">The directory name is invalid</PRE><P>
However if you use a Universal Naming Convention (UNC) path name to
create the directory Windows will allow it:</P>
<PRE STYLE="margin-left: 0.79in; margin-bottom: 0.2in">C:\&gt; mkdir \\.\C:\aux</PRE><P>
This also applies to copying and moving files that use reserved
MS-DOS device names.</P>
<P>By placing the virus in a file that uses a reserved MS-DOS device
name, or by placing the virus in a file that uses a reserved MS-DOS
device name it is possible to avoid detection by Sophos Small
Business Suite antivirus (and other products).
</P>
<P>Take a copy of the eicar.com file (or another virus) and copy it
into a reserved MS-DOS device name:</P>
<PRE STYLE="margin-left: 0.79in; margin-bottom: 0.2in">copy eicar.com \\.\C:\aux</PRE><P>
Then attempt to scan the file, normally antivirus software would
detect it immediately, however in this case it will not be detected.
</P>
<P>If you right click on a file that uses a reserved MS-DOS device
name that contains a virus and choose &ldquo;Scan with Norton
AntiVirus&rdquo; it will fail, possibly with the error message
</P>
<P STYLE="margin-left: 0.79in">&quot;Unable to open the file &lt;file
name&gt;. The file is in use by another application or you don't have
permission to open the file.&quot; (3019,2)
</P>
<P>Sophos Small Business Suite antivirus appears to be most
vulnerable to this problem during a full system scan, on demand
scanning appears the least vulnerable (once the file is accessed it
is usually detected) and right clicking on a directory has varrying
degrees of success, from no detection to successful detection and
removal. Sophos Small Business Suite antivirus appears vulnerable to
reserved device names with and without extensions such as &ldquo;.exe&rdquo;.
</P>
<P>Some MS-DOS reserved device name extensions include:</P>
<UL>
<LI><P><STRONG>aux</STRONG></P>
<LI><P><STRONG>com1</STRONG></P>
<LI><P><STRONG>com2</STRONG></P>
<LI><P><STRONG>com3</STRONG></P>
<LI><P><STRONG>com4</STRONG></P>
<LI><P><STRONG>com5</STRONG></P>
<LI><P><STRONG>com6</STRONG></P>
<LI><P><STRONG>com7</STRONG></P>
<LI><P><STRONG>com8</STRONG></P>
<LI><P><STRONG>com9</STRONG></P>
<LI><P><STRONG>con</STRONG></P>
<LI><P><STRONG>lpt1</STRONG></P>
<LI><P><STRONG>lpt2</STRONG></P>
<LI><P><STRONG>lpt3</STRONG></P>
<LI><P><STRONG>lpt4</STRONG></P>
<LI><P><STRONG>lpt5</STRONG></P>
<LI><P><STRONG>lpt6</STRONG></P>
<LI><P><STRONG>lpt7</STRONG></P>
<LI><P><STRONG>lpt8</STRONG></P>
<LI><P><STRONG>lpt9</STRONG></P>
<LI><P><STRONG>prn</STRONG></P>
</UL>
<P><STRONG>Testing was done on both Windows 2000 and XP with
essentially the same results in all cases. </STRONG>
</P>
<P><STRONG>Solutions and workarounds:</STRONG></P>
<P>Ensure that no directories or files using reserved MS-DOS device
names are in use.
</P>
<P><STRONG>Additional information:</STRONG></P>
<P>This vulnerability eixsts in a number of products, and more
generic MS-DOS reserved device name issues exist in other software,
ranging from the Apache HTTPD server on Windows to email clients and
backup software.
</P>
<P><STRONG>References:</STRONG></P>
<P>None</P>
<P><A HREF="http://support.microsoft.com/default.aspx?scid=kb;en-us;103168">http://support.microsoft.com/default.aspx?scid=kb;en-us;103168</A></P>
<P><STRONG>A note on eicar.com</STRONG></P>
<P>Please note that although many people consider the &ldquo;legitimate&rdquo;
eicar.com test virus should only be detected when it is in a file
names eicar.com Sophos Small Business Suite antivirus will detect it
regardless of the filename and extension.
</P>
<P><B>History:</B></P>
<P>July 2004 &ndash; Vendor notified via iDEFENSE</P>
<P><STRONG>Other acknowledgements / thanks / greetings / information:</STRONG></P>
<P>None</P>
<P><STRONG>URL for advisory, signature and keys:</STRONG></P>
<P><A HREF="http://www.seifried.org/security/advisories/kssa-005.html">http://www.seifried.org/security/advisories/kssa-005.html</A>
</P>
<P><A HREF="http://www.seifried.org/security/advisories/kssa-005.html.asc">http://www.seifried.org/security/advisories/kssa-005.html.asc</A></P>
<P><BR><BR>
</P>
<HR>
<P>Permission is granted for copying and circulating this Bulletin to
the Internet community for the purpose of alerting them to problems,
if and only if, the bulletin is not edited or changed in any way, is
attributed to Kurt Seifried <A HREF="/cdn-cgi/l/email-protection#2f445a5d5b6f5c4a46495d464a4b01405d48"><span class="__cf_email__" data-cfemail="19726c6b6d596a7c707f6b707c7d37766b7e">[email&#160;protected]</span><script data-cfhash='f9e31' type="text/javascript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script></A>,
and provided such reproduction and/or distribution is performed for
non-commercial purposes.</P>
<P>Any other use of this information is prohibited. Kurt Seifried
<A HREF="/cdn-cgi/l/email-protection#4a213f383e0a392f232c38232f2e6425382d"><span class="__cf_email__" data-cfemail="513a2423251122343837233834357f3e2336">[email&#160;protected]</span><script data-cfhash='f9e31' type="text/javascript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script></A> is not
liable for any misuse of this information by any third party.</P>
<HR>
<P>Last updated 1/10/2004</P>
<P>Copyright Kurt Seifried 2004</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<script type="text/javascript">/* <![CDATA[ */(function(d,s,a,i,j,r,l,m,t){try{l=d.getElementsByTagName('a');t=d.createElement('textarea');for(i=0;l.length-i;i++){try{a=l[i].href;s=a.indexOf('/cdn-cgi/l/email-protection');m=a.length;if(a&&s>-1&&m>28){j=28+s;s='';if(j<m){r='0x'+a.substr(j,2)|0;for(j+=2;j<m&&a.charAt(j)!='X';j+=2)s+='%'+('0'+('0x'+a.substr(j,2)^r).toString(16)).slice(-2);j++;s=decodeURIComponent(s)+a.substr(j,m-j)}t.innerHTML=s.replace(/</g,'&lt;').replace(/>/g,'&gt;');l[i].href='mailto:'+t.value}}catch(e){}}}catch(e){}})(document);/* ]]> */</script></BODY>
</HTML>
